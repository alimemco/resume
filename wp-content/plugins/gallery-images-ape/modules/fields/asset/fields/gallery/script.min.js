/*  
 * Ape Gallery			
 * Author:            	Wp Gallery Ape 
 * Author URI:        	https://wpape.net/
 * License:           	GPL-2.0+
 */
!function(e){function t(e){var t=jQuery(o),l={action:"wpape_gallery_get_images_from_ids",idstring:e};jQuery.post(ajaxurl,l,function(e){t.html(e);var l=t.find("img").length;if(l<=10)t.addClass("items10");else if(l<=20)t.addClass("items20");else if(l<=30)t.addClass("items30");else t.addClass("items50")})}var l,a,i,n,r="gallery-library",o=document.getElementById("ape_gallery_images_preview"),s=document.getElementsByClassName("wpapeGalleryFieldImagesButton");if(0!=s.length){s=s[0];i=document.getElementById(s.getAttribute("data-id"));t(a=i.value);n=""==a?[]:a.split(",");o.addEventListener("click",function(e){e.preventDefault();if(e.target.matches("img"))s.click()});var d=function(e){if(!l){if(n.length>0)r="gallery-edit";(l=new wp.media.view.emWpGallery({multiple:!0,state:r,library:{order:"ASC",orderby:"title",type:"image",search:null,uploadedTo:null,multiple:!0}})).on("ready",function(){if(0!=n.length){var e=l.state().get("library");wp.media.query({post__in:n}).more().then();n.forEach(function(t){var l=wp.media.attachment(t);if(void 0!=jQuery)l=jQuery.extend(!0,wp.media.attachment(t),{attributes:{sizes:{medium:{url:apeGalleryFieldGallery.iconUrl}}}});e.add(l)})}});l.on("open",function(){if(0!=n.length&&"gallery-edit"!=r){l.setState("gallery-edit");l.options.state="gallery-edit";r="gallery-edit"}});l.on("insert",function(){var e=l.state().get("selection");console.log(e)});l.on("update",function(e){var r,o=l.state();if(r=e||o.get("selection")){var s=r.toJSON();if(0!=s.length){n=[];for(var d=0;d<s.length;d++)n.push(s[d].id);a=n.join(",");console.log("idsList",a);t(a);i.value=a;console.log("gallery array",n)}}else console.log("return selection")});l.open()}else l.open()};s.addEventListener("click",d)}else console.log("button not found ")}(jQuery);